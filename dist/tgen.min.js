/*
 tgen.js - the seamless texture generator
 https://github.com/schalkt/tgen/
 http://texture-generator.com/

 Copyright (c) 2015 Tamas Schalk
 MIT license

 @version 0.5.0
*/
(function(g){window[g]={version:"0.5.0",defaults:{},effects:{},blends:{},shapes:{},colormaps:{},events:{beforeEffect:{},afterEffect:{},beforeRender:{},afterRender:{}},config:{historyLast:15,historyName:"history",historyList:[]},effect:function(b,a,c){this.defaults[b]=a;this.effects[b]=c},event:function(b,a,c){void 0!=this.events[b]&&(this.events[b][a]=c)},blend:function(b,a){this.blends[b]=a},shape:function(b,a){this.shapes[b]=a},colormap:function(b,a){this.colormaps[b]=a},init:function(b,a,c){var d=
this,f=[],h={},k=0,g=null,e={shape:d.shapes,effects:Object.keys(d.effects),layers:[],normalize:c?c:"limitless"},l=function(){void 0==b&&(b=256);1>b&&(b=256);1>a&&(a=256);1024<b&&(b=1024);1024<a&&(a=1024);void 0==a&&(a=b);g=(b+a)/2};l();e.clear=function(){e.texture.clear();e.layers=[];f=[];k=0;h.start=(new Date).getTime();return e};e.buffer=function(c){this.data=null;this.components=4;this.width=b;this.height=a;this.wha=(this.width+this.height)/2;this.background=[0,0,0,255];"object"==typeof c&&(this.background=
c);this.pixels=function(){return this.width*this.height};this.size=function(){return this.data.length};this.export=function(){var a=this.size();switch(e.normalize){case "limitless":for(var b=new Float32Array(a);a--;)b[a]=this.data[a];break;case "clamped":for(b=new Uint8ClampedArray(a);a--;)b[a]=this.data[a];break;case "pingpong":for(b=new Uint8ClampedArray(a);a--;)b[a]=e.calc.pingpong(this.data[a],0,255)}return b};this.clear=function(a){this.data=new Float32Array(this.width*this.height*this.components);
void 0==a&&(a=this.background);for(var b=this.size();b;)this.data[b-1]=a[3],this.data[b-2]=a[2],this.data[b-3]=a[1],this.data[b-4]=a[0],b-=this.components};this.pattern=function(a,b){var c=a/b;if(a>=b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,a=b-Math.abs(a-c),a>=b&&(a-=b),a};this.offset=function(a,b){a=Math.round(a);b=Math.round(b);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.components+a*this.components};
this.set=function(a,b,c){a=this.offset(a,b);this.data[a]=c[0];this.data[a+1]=c[1];this.data[a+2]=c[2];this.data[a+3]=c[3]};this.get=function(a,b){a=this.offset(a,b);return[this.data[a],this.data[a+1],this.data[a+2],this.data[a+3]]};this.canvas=function(a){var b=this.size();for(a=a.getContext("2d").getImageData(0,0,this.width,this.height).data;b--;)e.texture.data[b]=a[b]};null===this.data&&this.clear()};e.texture=new e.buffer;e.layerCopy=function(a){var b=[];a=this.layers[a];for(var c=a.length;c--;)b[c]=
a[c];return b};var n=function(a,b){var c={},m;for(m in a)c[m]=a[m];for(m in b)c[m]=b[m];return c};e.clone=function(a,b){for(var c in b)"object"===typeof b[c]&&null!==b[c]&&a[c]?this.clone(a[c],b[c]):a[c]=b[c]};e.randInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};e.randIntSeed=function(a,b){return Math.floor(e.calc.randomseed()*(b-a+1))+a};e.randReal=function(a,b){return Math.random()*(b-a)+a};e.randRealSeed=function(a,b){return e.calc.randomseed()*(b-a)+a};e.randByArray=function(a,
b){"object"==typeof a&&(a=void 0!=b?e.randReal(a[0],a[1]):e.randInt(a[0],a[1]));return a};e.randByArraySeed=function(a,b){"object"==typeof a&&(a=void 0!=b?e.randRealSeed(a[0],a[1]):e.randIntSeed(a[0],a[1]));return a};var p=function(a){void 0===a&&(a=255);!0===a&&(a=128+e.randInt(0,128));return[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),a]};e.randItem=function(a){var b=e.randInt(0,a.length-1);return a[b]};var t=function(a){var b,c=0,m;for(m in a)Math.random()<1/++c&&(b=m);return b};e.rgba=
function(a,b){if("random"===a)return p(b);if("randomalpha"===a)return p(!0);"object"==typeof a[0]&&(a[0]=e.randInt(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=e.randInt(a[1][0],a[1][1]));"object"==typeof a[2]&&(a[2]=e.randInt(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=e.randInt(a[3][0],a[3][1]));0!==a[3]%1&&(a[3]=Math.round(255*a[3]));1==a[3]&&(a[3]=255);return a};e.findClosestIndex=function(a,b,c){for(;0<=b&&b<=a.length-1;b+=c)if(a[b])return b;return a.length-1};e.calc={pi:3.1415927,luminance:function(a){return.21*
a[0]+.72*a[1]+.07*a[2]},randomseed:function(a){void 0==this.seed&&(this.seed=e.randInt(1,262140));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);return a-Math.floor(a)},normalize1:function(a){return e.calc.normalize(a,0,1)},normalize:function(a,b,c){return a>c?c:a<b?b:a},pingpong:function(a,b,c){return a>c?c-(a-c):a<b?Math.abs(b):a},interpolate:{linear:function(a,b,c){return a*(1-c)+b*c},cosine:function(a,b,c){c=.5*(1-Math.cos(c*e.calc.pi));return a*(1-c)+b*c},catmullrom:function(a,b,c,d,e,
f){e/=f;d=d-c-(a-b);a=d*e*e*e+(a-b-d)*e*e+(c-a)*e+b;0>a&&(a=0);1<a&&(a=1);return a}}};e.colormap={data:null,size:255,init:function(a,c,f){this.data=null;this.size=void 0==c?b:c;if(void 0==a||null==a)return a;if("object"==typeof a)if("object"==typeof a[0])for(key in a){var m=a[key];m.rgba=e.rgba(m.rgba);a[key]=m}else a=e.randItem(a);if("random"===a){m=e.randInt(1,4);a=[];for(var r=0;r<=m;r++)a[r]={percent:parseInt(r/m*100),rgba:[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),255]}}"function"==
typeof f&&f(a);"string"==typeof a&&(f=!1,"!"==a.charAt(0)&&(a=a.substring(1),f=!0),"function"==typeof d.colormaps[a]&&(c=d.colormaps[a](c),this.data=this.render(c,f)));"object"==typeof a&&(this.data=this.render(a))},render:function(a,b){for(var c=[],d=0;d<a.length-1;d++)for(var e=a[d],m=a[d+1],r=Math.round(e.percent/100*this.size),f=Math.round(m.percent/100*this.size),h=r;h<=f;h++)c[b?this.size-h:h]=[e.rgba[0]+(h-r)/(f-r)*(m.rgba[0]-e.rgba[0]),e.rgba[1]+(h-r)/(f-r)*(m.rgba[1]-e.rgba[1]),e.rgba[2]+
(h-r)/(f-r)*(m.rgba[2]-e.rgba[2]),e.rgba[3]+(h-r)/(f-r)*(m.rgba[3]-e.rgba[3])];return c},get:function(a,b){if(void 0==a)return this.data;a=e.calc.pingpong(parseInt(a),0,this.size);a=this.data[a];void 0!==b&&(a[3]=b[3]);return a}};e.wrapx=function(a){return a&b-1};e.wrapy=function(b){return b&a-1};e.point={rgba:[],mixed:[],blend:"opacity",colorize:function(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:255]},opacity:function(a,b){if(255==
a[3])return a[3]=b[3],a;if(0==b[3])return b;var c=a[3]/255;return[a[0]*c+b[0]*(1-c),a[1]*c+b[1]*(1-c),a[2]*c+b[2]*(1-c),b[3]]},set:function(a,b){var c=e.texture.get(a,b);void 0!==d.blends[this.blend]?(this.rgba=d.blends[this.blend](e,c,this.rgba),this.mixed=this.opacity(this.rgba,c)):this.mixed=this.rgba;switch(e.normalize){case "clamped":this.mixed[0]=Math.max(0,Math.min(255,this.mixed[0]));this.mixed[1]=Math.max(0,Math.min(255,this.mixed[1]));this.mixed[2]=Math.max(0,Math.min(255,this.mixed[2]));
this.mixed[3]=Math.max(0,Math.min(255,this.mixed[3]));break;case "pingpong":this.mixed[0]=e.calc.pingpong(this.mixed[0],0,255),this.mixed[1]=e.calc.pingpong(this.mixed[1],0,255),this.mixed[2]=e.calc.pingpong(this.mixed[2],0,255),this.mixed[3]=e.calc.pingpong(this.mixed[3],0,255)}e.texture.set(a,b,this.mixed)},get:function(a,b,c){return e.texture.get(a,b)}};e.walk=function(c){for(var d=0;d<b;d++)for(var f=0;f<a;f++){var m=e.point.get(d,f);m=c(m,d,f);e.point.rgba=m;e.point.set(d,f)}};e.percent=function(a,
b){return parseInt(a/100*b,10)};e.percentX=function(a){return parseInt(a/100*b,10)};e.percentY=function(b){return parseInt(b/100*a,10)};e.percentXY=function(a){return parseInt(a/100*g,10)};e.xysize=function(c,d){if(void 0!=d.elements){var f=d.elements[c].x,m=d.elements[c].y;c=d.elements[c].size}else"random"==d.origin?(f=e.randIntSeed(0,b),m=e.randIntSeed(0,a)):(f=d.origin[0],m=d.origin[1]),c=e.randByArraySeed(d.size);return{x:f,y:m,size:c}};e.toContext=function(c,d){c=c.createImageData(b,a);for(var e=
c.data,f=d.length,m=0;m<f;m+=4)e[m]=d[m],e[m+1]=d[m+1],e[m+2]=d[m+2],e[m+3]=d[m+3];return c};e.toCanvas=function(c){void 0==c&&(c=e.texture.data);var d=document.createElement("canvas");d.width=b;d.height=a;var f=d.getContext("2d");c=this.toContext(f,c);f.putImageData(c,0,0);return d};e.getCanvas=function(a){if(a){var b=this.toCanvas(this.layers[this.layers.length-1]);a(b)}return this};e.getPhases=function(a){if(a){for(var b=[],c=e.layers.length,d=0;d<c;d++)b.push(this.toCanvas(this.layers[d]));a(b)}return this};
e.stat=function(a){h.stop=(new Date).getTime();h.elapsed=(h.stop-h.start)/1E3;a&&a(h);return this};e.history={available:function(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(m){return!1}},list:function(){return this.available()?JSON.parse(window.localStorage.getItem(d.config.historyName))||[]:[]},last:function(){return this.available()?d.config.historyList[d.config.historyList.length-1]:[]},get:function(a){return this.available()?d.config.historyList[a]?
d.config.historyList[a]:null:[]},add:function(a){if(d.config.historyLast){if(!this.available())return[];a=e.params(a);d.config.historyList=JSON.parse(window.localStorage.getItem(d.config.historyName))||[];d.config.historyList.length>=d.config.historyLast&&d.config.historyList.shift();d.config.historyList.push(a);window.localStorage.setItem(d.config.historyName,JSON.stringify(d.config.historyList))}}};e.params=function(c){void 0==c&&(c=new Date,c=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+
" l"+e.layers.length+" i"+f.length);return{name:c,version:d.version,width:b,height:a,normalize:e.normalize,items:f}};e.render=function(c,f){e.event("beforeRender",c);var h=0;void 0!=c.width&&(b=c.width);void 0!=c.height&&(a=c.height);e.normalize=void 0!=c.normalize?c.normalize:"limitless";l();e.texture=new e.buffer(c.background);1!=f&&e.clear();for(var m in c.items){k=c.items[m][0];f=c.items[m][1];var r=c.items[m][2];"random"==f&&(f=t(e.defaults));"object"==typeof f&&(f=e.randItem(f));h!=k&&(void 0!=
e.layers[k]?e.texture.data=e.layers[k]:e.texture.clear(),h=k);if(void 0!=e[f])e[f](r);else void 0!=d.effects[f]?e.do(f,r):console.warn("undefined effect: "+f);e.layers[k]=e.texture.export()}e.event("afterRender",e.params());e.history.add();return this};e.event=function(a,b){for(var c in d.events[a]){var f=d.events[a][c];"function"==typeof f&&f(e,b)}};e.do=function(a,b){var c=b;void 0===b?b=n({},d.defaults[a]):"object"==typeof b&&(b=n(d.defaults[a],b));"object"==typeof b.count&&(b.count=e.randInt(b.count[0],
b.count[1]));"random"===b.blend&&(b.blend=t(d.blends));"object"==typeof b.blend&&(b.blend=b.blend[e.randInt(0,b.blend.length-1)]);e.point.blend=void 0!==b.blend?b.blend:"";b.rgba&&(b.rgba=e.rgba(b.rgba),e.point.rgba=[b.rgba[0],b.rgba[1],b.rgba[2],b.rgba[3]]);b.rgb&&(b.rgb=e.rgba(b.rgb),e.point.rgba=[b.rgb[0],b.rgb[1],b.rgb[2],255]);e.event("beforeEffect",{layer:k,name:a,params:b});"function"==typeof d.effects[a]?b=d.effects[a](e,b):console.warn("effect not callable: "+a);void 0===b&&(b=c);e.event("afterEffect",
{layer:k,name:a,params:b});!1!==b.store&&f.push([k,a,b]);return e};return e}}})("tgen");(function(g){g=window[g];g.colormap("blackwhite",function(){return[{percent:0,rgba:[0,0,0,255]},{percent:25,rgba:[255,255,255,255]},{percent:50,rgba:[0,0,0,255]},{percent:75,rgba:[255,255,255,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("dawn",function(){return[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,128,255]},{percent:75,rgba:[128,0,128,255]},{percent:100,rgba:[0,0,128,255]}]});g.colormap("dusk",function(){return[{percent:0,rgba:[255,
255,255,255]},{percent:25,rgba:[255,128,255,255]},{percent:50,rgba:[128,0,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("kryptonite",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,0,255]},{percent:75,rgba:[0,128,0,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("ice",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[128,255,255,255]},{percent:50,rgba:[0,128,255,255]},
{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("fire",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,0,255]},{percent:75,rgba:[128,0,0,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("redblue",function(){return[{percent:0,rgba:[96,0,0,255]},{percent:25,rgba:[192,0,0,255]},{percent:50,rgba:[255,255,255,255]},{percent:75,rgba:[0,0,192,255]},{percent:100,rgba:[0,0,96,255]}]});g.colormap("seashore",function(){return[{percent:0,
rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,128,255]},{percent:75,rgba:[0,128,128,255]},{percent:100,rgba:[0,0,128,255]}]})})("tgen");(function(g){g=window[g];g.blend("opacity",function(b,a,c){return c});g.blend("multiply",function(b,a,c){c[0]=a[0]*c[0]/255;c[1]=a[1]*c[1]/255;c[2]=a[2]*c[2]/255;return c});g.blend("difference",function(b,a,c){c[0]=Math.abs(c[0]-a[0]);c[1]=Math.abs(c[1]-a[1]);c[2]=Math.abs(c[2]-a[2]);return c});g.blend("screen",function(b,a,c){c[0]=255-(255-a[0])*(255-c[0])/255;c[1]=255-(255-a[1])*(255-c[1])/255;c[2]=255-(255-a[2])*(255-c[2])/255;return c});g.blend("overlay",function(b,a,c){c[0]=128<a[0]?255-2*(255-
c[0])*(255-a[0])/255:a[0]*c[0]*2/255;c[1]=128<a[1]?255-2*(255-c[1])*(255-a[1])/255:a[1]*c[1]*2/255;c[2]=128<a[2]?255-2*(255-c[2])*(255-a[2])/255:a[2]*c[2]*2/255;return c});g.blend("exclusion",function(b,a,c){c[0]=128-2*(a[0]-128)*(c[0]-128)/255;c[1]=128-2*(a[1]-128)*(c[1]-128)/255;c[2]=128-2*(a[2]-128)*(c[2]-128)/255;return c});g.blend("darken",function(b,a,c){c[0]=c[0]<a[0]?c[0]:a[0];c[1]=c[1]<a[1]?c[1]:a[1];c[2]=c[2]<a[2]?c[2]:a[2];return c});g.blend("lighten",function(b,a,c){c[0]=c[0]>a[0]?c[0]:
a[0];c[1]=c[1]>a[1]?c[1]:a[1];c[2]=c[2]>a[2]?c[2]:a[2];return c});g.blend("lineardodge",function(b,a,c){c[0]=a[0]+c[0];c[1]=a[1]+c[1];c[2]=a[2]+c[2];return c});g.blend("linearlight",function(b,a,c){c[0]=a[0]+2*c[0]-255;c[1]=a[1]+2*c[1]-255;c[2]=a[2]+2*c[2]-255;return c});g.blend("linearburn",function(b,a,c){c[0]=a[0]+c[0]-255;c[1]=a[1]+c[1]-255;c[2]=a[2]+c[2]-255;return c});g.blend("softlight",function(b,a,c){c[0]=128<a[0]?255-(255-a[0])*(255-(c[0]-128))/255:a[0]*(c[0]+128)/255;c[1]=128<a[1]?255-
(255-a[1])*(255-(c[1]-128))/255:a[1]*(c[1]+128)/255;c[2]=128<a[2]?255-(255-a[2])*(255-(c[2]-128))/255:a[2]*(c[2]+128)/255;return c})})("tgen");(function(g){g=window[g];g.effect("fill",{blend:"",rgba:[128,128,128,255]},function(b,a){b.shape.rect(b,1,1,b.texture.width,b.texture.height);return a});g.effect("copy",{layer:null},function(b,a){"number"==typeof a&&(a={layer:a});null===a.layer&&(a.layer=b.layers.length-1);void 0!=b.layers[a.layer]&&(b.texture.data=b.layerCopy(a.layer));return a});g.effect("merge",{blend:"opacity",layer:0,opacity:null},function(b,a){if(void 0===b.layers[a.layer])return this;for(var c=b.layers[a.layer],d=0;d<b.texture.height;d++)for(var f=
0;f<b.texture.width;f++){var h=b.texture.offset(f,d);b.point.rgba=[c[h],c[h+1],c[h+2],a.opacity?a.opacity:c[h+3]];b.point.set(f,d)}return a});g.effect("noise",{blend:"softlight",mode:"monochrome",opacity:128},function(b,a){"color"==a.mode?b.walk(function(c){return c=[b.randInt(0,255),b.randInt(0,255),b.randInt(0,255),a.opacity]}):b.walk(function(c){c=b.randInt(0,255);return c=[c,c,c,a.opacity]});return a});g.effect("spheres",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,
70],seed:[1,262140]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);for(var c=0;c<a.count;c++){var d=b.xysize(c,a);b.shape.sphere(b,b.percentX(d.x),b.percentY(d.y),b.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});g.effect("pyramids",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[21,100],seed:[1,262140]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);for(var c=0;c<a.count;c++){var d=b.xysize(c,a);b.shape.pyramid(b,b.percentX(d.x),
b.percentY(d.y),b.percentXY(d.size),b.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});g.effect("squares",{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50],seed:[1,262140]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);for(var c=0;c<a.count;c++){var d=b.xysize(c,a);b.shape.rect(b,b.percentX(d.x),b.percentY(d.y),b.percentXY(d.size),b.percentXY(d.size),!1)}return a});g.effect("circles",{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15],seed:[1,
262140]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);for(var c=0;c<a.count;c++){var d=b.xysize(c,a);b.shape.circle(b,b.percentX(d.x),b.percentY(d.y),b.percentXY(d.size),!0)}return a});g.effect("lines",{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},function(b,a){a.freq1s=b.randByArray(a.freq1s,!0);a.freq1c=b.randByArray(a.freq1c,!0);a.freq2s=b.randByArray(a.freq2s,!0);a.freq2c=b.randByArray(a.freq2c,
!0);a.size=b.randByArray(a.size);for(var c=0;c<a.count;c++)b.shape.line(b,b.texture.width/2+Math.sin(c/a.freq1s*b.calc.pi)*a.size,b.texture.height/2+Math.cos(c/a.freq1c*b.calc.pi)*a.size,b.texture.width/2+Math.sin(c/a.freq2s*b.calc.pi)*a.size,b.texture.height/2+Math.cos(c/a.freq2c*b.calc.pi)*a.size);return a});g.effect("lines2",{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,12],count:[2,32],seed:[1,262140]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);
for(var c=0;c<a.count;c++){var d=void 0!=a.elements?a.elements[c]:{size:b.randByArraySeed(a.size,!0),d:b.randRealSeed(.1,100)};"vertical"==a.type?b.shape.rect(b,b.percentX(d.d),0,b.percentX(d.size),b.texture.height):b.shape.rect(b,0,b.percentX(d.d),b.texture.width,b.percentX(d.size))}return a});g.effect("subplasma",{seed:[1,262140],size:[3,4],rgba:"random"},function(b,a){a.seed=b.randByArray(a.seed);a.size=b.randByArray(a.size);b.calc.randomseed(a.seed);var c=1<<a.size,d=b.texture.width,f=[],h,k;
c>d&&(c=d);var g=d/c;for(k=0;k<c;k++)for(h=0;h<c;h++)f[h*g+k*g*d]=b.calc.randomseed();for(k=0;k<c;k++)for(h=0;h<d;h++){var e=h&~(g-1),l=k*g*d;f[h+l]=b.calc.interpolate.catmullrom(f[(e-1*g&d-1)+l],f[(e-0*g&d-1)+l],f[(e+1*g&d-1)+l],f[(e+2*g&d-1)+l],h%g,g)}for(k=0;k<d;k++)for(h=0;h<d;h++)e=k&~(g-1),f[h+k*d]=b.calc.interpolate.catmullrom(f[h+(e-1*g&d-1)*d],f[h+(e-0*g&d-1)*d],f[h+(e+1*g&d-1)*d],f[h+(e+2*g&d-1)*d],k%g,g);for(h=0;h<b.texture.width;h++)for(k=0;k<b.texture.height;k++)c=255*f[h+k*d],b.point.rgba=
b.point.colorize(a.rgba,[c,c,c,255]),b.point.set(h,k);return a});g.effect("waves",{blend:"opacity",rgba:"random",level:50,xsines:[1,10],ysines:[1,10]},function(b,a){void 0===a.xsines?a.xsines=b.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=b.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=b.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=b.randInt(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=b.rgba([[0,255],[0,255],[0,255],void 0!==a.opacity?a.opacity:255]));for(var c=0;c<
b.texture.width;c++)for(var d=0;d<b.texture.height;d++){var f=127+63.5*Math.sin(c/b.texture.width*a.xsines*2*b.calc.pi)+63.5*Math.sin(d/b.texture.height*a.ysines*2*b.calc.pi);b.point.rgba="object"==typeof a.channels?[a.channels[0]?f:0,a.channels[1]?f:0,a.channels[2]?f:0,a.channels[3]?f:0]:b.point.colorize([f,f,f,255],a.rgba,a.level);b.point.set(c,d)}return a});g.effect("crosshatch",{blend:"random",level:50},function(b,a){void 0==a.xadjust&&(a.xadjust=b.randInt(1,10));void 0===a.yadjust&&(a.yadjust=
b.randInt(1,10));void 0===a.rgba&&(a.rgba=[b.randInt(0,255),b.randInt(0,255),b.randInt(0,255),255]);for(var c=0;c<b.texture.width;c++)for(var d=0;d<b.texture.height;d++){var f=127+63.5*Math.sin(c*c/a.xadjust)+63.5*Math.cos(d*d/a.yadjust);b.point.rgba=b.point.colorize([f,f,f,255],a.rgba,a.level);b.point.set(c,d)}return a});g.effect("map",{xamount:[5,255],yamount:[5,255],xchannel:[0,2],ychannel:[0,2],xlayer:0,ylayer:0},function(b,a){a.xamount=b.randByArray(a.xamount);a.yamount=b.randByArray(a.yamount);
a.xchannel=b.randByArray(a.xchannel);a.ychannel=b.randByArray(a.ychannel);a.xlayer=b.randByArray(a.xlayer);a.ylayer=b.randByArray(a.ylayer);for(var c=new b.buffer,d=b.texture.width,f=b.texture.height,h=b.layers[a.xlayer],g=b.layers[a.ylayer],q=0;q<d;q++)for(var e=0;e<f;e++){var l=b.texture.offset(q,e),n=h[l+a.xchannel],p=g[l+a.ychannel];n=0==d%16?b.wrapx(q+(n*a.xamount*d>>16)):q+n*a.xamount*d/(d*d);p=0==f%16?b.wrapy(e+(p*a.yamount*f>>16)):e+p*a.yamount*f/(f*f);p=b.point.get(n,p);c.data[l]=p[0];c.data[l+
1]=p[1];c.data[l+2]=p[2];c.data[l+3]=p[3]}for(d=b.texture.size();d--;)b.texture.data[d]=c.data[d];return a});g.effect("clouds",{blend:"opacity",rgba:"random",seed:[1,262140],roughness:[2,16],colormap:null},function(b,a){a.seed=b.randByArray(a.seed);a.roughness=b.randByArray(a.roughness);var c=b.texture.width,d=b.texture.height,f=[],h=function(a,b,e){a=Math.round(a);b=Math.round(b);0>a&&(a=c+a);a>=c&&(a-=c);0>b&&(b=d+b);b>=d&&(b-=d);return void 0!==e?f[a][b]=e:f[a][b]},g=function(d){return(b.calc.randomseed()-
.5)*(d/(c+c))*a.roughness},q=function(e){var f=e/2;if(1>=f)return a;for(var k=f-f;k<=c+f;k+=f)for(var l=f-f;l<=d+f;l+=f){var p=h(k-f,l-f),n=h(k,l-f),x=h(k-f,l),w=h(k,l),v=k-f/2,z=l-f/2;w=h(v,z,b.calc.normalize1((p+n+x+w)/4+g(e)));h(k-f,z,b.calc.normalize1((p+x+w+h(k-e+f/2,z))/4+g(e)));h(v,l-f,b.calc.normalize1((p+n+w+h(v,l-e+f/2))/4+g(e)))}q(f)};b.calc.randomseed(a.seed);(function(){for(var a=0;a<=c;a++){f[a]=[];for(var b=0;b<=d;b++)f[a][b]=0}})();q(c);b.colormap.init(a.colormap,255,function(b){a.colormap=
b});for(var e=0;e<c;e++)for(var l=0;l<d;l++){var n=parseInt(255*f[e][l],10);b.point.rgba=null!==b.colormap.data?b.colormap.get(n,a.rgba):b.point.colorize(a.rgba,[n,n,n,255]);b.point.set(e,l)}return a});g.effect("colorbar",{type:"horizontal",mirror:!1,colormap:[{percent:0,rgba:[[0,255],[0,255],[0,255],255]},{percent:25,rgba:[[0,255],[0,255],[0,255],255]},{percent:50,rgba:[[0,255],[0,255],[0,255],255]},{percent:75,rgba:[[0,255],[0,255],[0,255],255]},{percent:100,rgba:[[0,255],[0,255],[0,255],255]}]},
function(b,a){var c=b.texture.width,d=b.texture.height;b.colormap.init(a.colormap,"horizontal"==a.type?c:d,function(b){a.colormap=b});if("horizontal"==a.type)for(var f=0;f<c;f++){if(a.mirror)var h=f<c/2?2*f:2*c-2*f;b.point.rgba=b.colormap.get(h);for(var g=0;g<d;g++)b.point.set(f,g)}else for(g=0;g<d;g++)for(a.mirror&&(h=g<d/2?2*g:2*d-2*g),b.point.rgba=b.colormap.get(h),f=0;f<c;f++)b.point.set(f,g);return a});g.effect("checkerboard",{size:[8,8],rgba:"randomalpha"},function(b,a){var c=b.texture.width,
d=b.texture.height;if("object"==typeof a.size)var f=a.size[0]=b.randByArray(a.size[0]),g=a.size[1]=b.randByArray(a.size[1]);else g=f=a.size;for(var k=c/f,q=d/g,e=function(a,e){for(var f=0;f<k;f++)for(var g=0;g<q;g++)f+a<c&&g+e<d&&b.point.set(f+a,g+e)},l=0;l<f;l++)if(0==l%2)for(var n=0;n<g;n++)0==n%2?e(l*k,n*q):e(l*k+k,n*q);return a});g.effect("dots",{blend:"opacity",gridX:[1,64],gridY:[1,64],size:[1,250],seed:[1,262140],rgba:"randomalpha",shape:"sphere",dynamic:!0,xsines:[1,16],ysines:[1,16]},function(b,
a){a.gridX=b.randByArray(a.gridX);a.gridY=b.randByArray(a.gridY);a.seed=b.randByArray(a.seed);void 0===a.xsines?a.xsines=b.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=b.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=b.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=b.randInt(a.ysines[0],a.ysines[1]));b.calc.randomseed(a.seed);for(var c=b.randByArraySeed(a.size)/100,d=b.texture.width/a.gridX,f=b.texture.height/a.gridY,g=d/2,k=f/2,q=1;q<=a.gridX;q++)for(var e=1;e<=a.gridY;e++){var l=
c*(d+f)/2/2;l=l-l/2*Math.sin(q/a.gridX*a.xsines*2*b.calc.pi)+l/2*Math.sin(e/a.gridY*a.ysines*2*b.calc.pi);switch(a.shape){case "sphere":b.shape.sphere(b,q*d-g,e*f-k,2*l,!0,a.rgba,a.dynamic);break;case "pyramid":b.shape.pyramid(b,q*d-g,e*f-k,l,l,!0,a.rgba,a.dynamic);break;case "rect":b.shape.rect(b,q*d-g,e*f-k,l,l,!0,a.rgba,a.dynamic);break;default:l/=2,b.shape.circle(b,q*d-g,e*f-k,l,!0)}}return a});g.effect("mandelbrot",{blend:"opacity",rgba:"randomalpha",seed:[1,262140],iteration:[8,512],skip:[0,
8]},function(b,a){a.seed=b.randByArray(a.seed);b.calc.randomseed(a.seed);a.skip=b.randByArray(a.skip);a.iteration=b.randByArray(a.iteration);for(var c=b.texture.width,d=b.texture.height,f=a.rgba[0],g=a.rgba[1],k=a.rgba[2],q=256/f,e=256/g,l=256/k,n=a.iteration,p,t,m,r,u,y,x=0;x<d;x++){t=-1.5+3*x/d;for(var w=0;w<c;w++){m=p=-2+3*w/c;u=t;for(var v=0;v<n;v++){r=m*m;y=u*u;if(4<r+y)break;r=r-y+p;u=2*m*u+t;m=r}v>a.skip&&(b.point.rgba=[v%f*q,v%g*e,v%k*l,b.point.rgba[3]],b.point.set(w,x))}}return a})})("tgen");(function(g){g=window[g];g.effect("opacity",{adjust:128},function(b,a){b.walk(function(b){b[3]=a.adjust;return b});return a});g.effect("vibrance",{adjust:50},function(b,a){var c=-1*a.adjust;b.walk(function(a){var b=Math.max(a[0],a[1],a[2]),d=2*Math.abs(b-(a[0]+a[1]+a[2])/3)/255*c/100;a[0]!==b&&(a[0]+=(b-a[0])*d);a[1]!==b&&(a[1]+=(b-a[1])*d);a[2]!==b&&(a[2]+=(b-a[2])*d);return[a[0],a[1],a[2],a[3]]});return a});g.effect("brightness",{adjust:50,legacy:!0},function(b,a){!0===a.legacy?b.walk(function(b){return[Math.min(b[0]+
a.adjust,255),Math.min(b[1]+a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]]}):b.walk(function(b){return[b[0]=Math.min(255/b[0]*(a.adjust/255),255),b[1]=Math.min(255/b[1]*(a.adjust/255),255),b[2]=Math.min(255/b[2]*(a.adjust/255),255),b[3]]});return a});g.effect("contrast",{adjust:50},function(b,a){var c=(100+a.adjust)/100;b.walk(function(a){a[0]=255*((a[0]/255-.5)*c+.5);a[1]=255*((a[1]/255-.5)*c+.5);a[2]=255*((a[2]/255-.5)*c+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),
Math.max(Math.min(a[2],255),0),a[3]]});return a});g.effect("threshold",{adjust:128},function(b,a){b.walk(function(b){b=.2126*b[0]+.7152*b[1]+.0722*b[2]<=a.adjust?0:255;return[b,b,b,1]});return a});g.effect("gamma",{adjust:.5},function(b,a){b.walk(function(b){b[0]=255*Math.pow(b[0]/255,1/a.adjust);b[1]=255*Math.pow(b[1]/255,1/a.adjust);b[2]=255*Math.pow(b[2]/255,1/a.adjust);return[b[0],b[1],b[2],b[3]]});return a});g.effect("grayscale",{method:["ligthness","average","luminosity"]},function(b,a){"string"==
typeof a&&(a={method:a});"object"==typeof a.method&&(a.method=b.randItem(a.method));switch(a.method){case "ligthness":b.walk(function(a){var b=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[b,b,b,a[3]]});break;case "average":b.walk(function(a){var b=(a[0]+a[1]+a[2])/3;return[b,b,b,a[3]]});break;case "luminosity":b.walk(function(a){var c=b.calc.luminance(a);return[c,c,c,a[3]]})}return a});g.effect("colorize",{level:50,rgba:"random",colormap:null},function(b,a){b.colormap.init(a.colormap,
255,function(b){a.colormap=b});b.walk(function(c){if(b.colormap.data){var d=b.colormap.get((c[0]+c[1]+c[2])/3,a.rgba);d[3]=c[3];return d}return b.point.colorize(c,a.rgba,a.level)});return a});g.effect("invert",{channels:[1,1,1]},function(b,a){b.walk(function(b){return[a.channels[0]?255-b[0]:b[0],a.channels[1]?255-b[1]:b[1],a.channels[2]?255-b[2]:b[2],b[3]]});return a});g.effect("sobel",{type:1},function(b,a){b.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,
1,-2,0,2,-1,0,1]});return a});g.effect("emboss",{type:1},function(b,a){b.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});return a});g.effect("edgedetect",{type:1},function(b,a){b.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,0]});return a});g.effect("sharpen",{type:1},function(b,a){b.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,-1,
-1,-1,-1]});return a});g.effect("blur",{},function(b,a){b.do("convolute",{store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});return a});g.effect("sinecolor",{sines:[1,7],channel:[0,2]},function(b,a){a.sines=b.randByArray(a.sines);a.channel=b.randByArray(a.channel);b.walk(function(c){var d=parseInt(255*Math.sin(b.calc.pi/180*c[a.channel]*(255/360)*a.sines));c[a.channel]=Math.abs(d);return c});return a});g.effect("convolute",{blend:"opacity",transparent:!1,weights:[1,1,1,1,1,1,
1,1,1]},function(b,a){if("object"!=typeof a.weights||null==a.weights)return a;var c=new b.buffer;c.clear();for(var d=Math.round(Math.sqrt(a.weights.length)),f=Math.floor(d/2),g=a.transparent?1:0,k=0;k<b.texture.height;k++)for(var q=0;q<b.texture.width;q++){for(var e=0,l=0,n=0,p=0,t=0;t<d;t++)for(var m=0;m<d;m++){var r=a.weights[t*d+m],u=b.texture.get(q+m-f,k+t-f);e+=u[0]*r;l+=u[1]*r;n+=u[2]*r;p+=u[3]}c.set(q,k,[e,l,n,p+g*(255-p)])}for(d=b.texture.size();d--;)b.texture.data[d]=c.data[d];return a})})("tgen");(function(g){g=window[g];g.shape("rect",function(b,a,c,d,f,g){void 0!==g&&(a-=parseInt(d/2,10),c-=parseInt(f/2,10));for(g=0;g<d;g++)for(var h=0;h<f;h++)b.point.set(a+g,c+h)});g.shape("circle",function(b,a,c,d,f){void 0==f&&(a+=d,c+=d);for(f=-d;f<d;f++)for(var g=Math.round(Math.sqrt(d*d-f*f)),k=-g;k<g;k++)b.point.set(a+f,c+k)});g.shape("line",function(b,a,c,d,f){var g=Math.sqrt((d-a)*(d-a)+(f-c)*(f-c));d=(d-a)/g;f=(f-c)/g;for(var k,q,e=0;e<g;e++)k=a+d*e,q=c+f*e,b.point.set(k,q)});g.shape("colorLine",
function(b,a,c,d,f,g){var h=Math.sqrt((d-a)*(d-a)+(f-c)*(f-c));d=(d-a)/h;f=(f-c)/h;for(var q,e,l=g.length,n=0;n<h;n++){q=a+d*n;e=c+f*n;var p=parseInt(n/h*l);b.point.rgba=g[p];for(p=1;7>=p;p++)b.point.set(q-p,e+p)}});g.shape("sphere",function(b,a,c,d,f,g,k){void 0==f&&(a+=d,c+=d);for(f=-d;f<d;f++)for(var h=parseInt(Math.sqrt(d*d-f*f),10),e=-h;e<h;e++){var l=Math.min(255,Math.max(0,255-255*Math.sqrt(e*e+f*f)/(d/2)))/255;0<l&&(b.point.rgba=[g[0]*l,g[1]*l,g[2]*l,k?255*l:g[3]],b.point.set(a+f,c+e))}});
g.shape("pyramid",function(b,a,c,d,f,g,k,q){var e=parseInt(d/2,10),h=parseInt(f/2,10);1!=g&&(a+=e,c+=h);for(g=-e;g<e;g++)for(var n=-h;n<h;n++){var p=255*(.25-Math.abs(g/d))+255*(.25-Math.abs(n/f));1<p&&(b.point.rgba=[k[0]/255*p,k[1]/255*p,k[2]/255*p,q?p:k[3]],b.point.set(a+g,c+n))}})})("tgen");
